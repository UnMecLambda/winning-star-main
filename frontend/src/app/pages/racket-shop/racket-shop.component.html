<div class="racket-shop-container">
  <div class="container">
    <div class="shop-header">
      <h1>Racket Shop</h1>
      <div class="coins-display">
        <lucide-icon name="star"></lucide-icon>
        <span>{{ userCoins | number }} coins</span>
      </div>
    </div>

    <div class="shop-tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'rackets'"
        (click)="activeTab = 'rackets'"
      >
        Rackets
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'components'"
        (click)="activeTab = 'components'"
      >
        Components
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'characters'"
        (click)="activeTab = 'characters'"
      >
        Characters
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'my-rackets'"
        (click)="activeTab = 'my-rackets'"
      >
        My Rackets
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'rental-market'"
        (click)="activeTab = 'rental-market'"
      >
        Rental Market
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'my-rentals'"
        (click)="activeTab = 'my-rentals'"
      >
        My Rentals
      </button>
    </div>

    <!-- Loading -->
    <div class="loading" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading shop...</p>
    </div>

    <!-- Rackets Tab -->
    <div class="tab-content" *ngIf="activeTab === 'rackets' && !loading">
      <div class="rackets-grid">
        <div class="racket-card" *ngFor="let racket of rackets" [style.background]="getRarityGradient(racket.rarity)">
          <div class="racket-header">
            <h3>{{ racket.name }}</h3>
            <span class="rarity-badge" [style.color]="getRarityColor(racket.rarity)">{{ racket.rarity | titlecase }}</span>
          </div>
          
          <div class="racket-visual">
            <div class="racket-preview" 
                 [style.background]="'linear-gradient(45deg, ' + racket.visualConfig.frameColor + ', ' + racket.visualConfig.handleColor + ')'">
              ðŸŽ¾
            </div>
          </div>

          <p class="racket-description">{{ racket.description }}</p>

          <div class="stats-grid">
            <div class="stat" *ngFor="let stat of ['power', 'control', 'speed', 'durability']">
              <lucide-icon [name]="getStatIcon(stat)"></lucide-icon>
              <span class="stat-name">{{ stat | titlecase }}</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width.%]="getStatValue(racket.baseStats, stat)"></div>
              </div>
              <span class="stat-value">{{ getStatValue(racket.baseStats, stat) }}</span>
            </div>
          </div>

          <div class="racket-actions">
            <div class="price">{{ racket.basePrice | number }} coins</div>
            <button 
              class="btn btn-primary"
              [disabled]="!canPurchaseRacket(racket)"
              (click)="purchaseRacket(racket)"
            >
              <lucide-icon name="shopping-cart"></lucide-icon>
              <span *ngIf="!isRacketOwned(racket)">Buy</span>
              <span *ngIf="isRacketOwned(racket)">Owned</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Components Tab -->
    <div class="tab-content" *ngIf="activeTab === 'components' && !loading">
      <div class="component-filters">
        <button 
          class="filter-btn" 
          [class.active]="selectedComponentType === 'all'"
          (click)="selectedComponentType = 'all'"
        >
          All
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedComponentType === 'strings'"
          (click)="selectedComponentType = 'strings'"
        >
          Strings
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedComponentType === 'handle'"
          (click)="selectedComponentType = 'handle'"
        >
          Handles
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedComponentType === 'grip_tape'"
          (click)="selectedComponentType = 'grip_tape'"
        >
          Grip Tape
        </button>
        <button 
          class="filter-btn" 
          [class.active]="selectedComponentType === 'dampener'"
          (click)="selectedComponentType = 'dampener'"
        >
          Dampeners
        </button>
      </div>

      <div class="components-grid">
        <div class="component-card" *ngFor="let component of filteredComponents" [style.border-color]="getRarityColor(component.rarity)">
          <div class="component-header">
            <h4>{{ component.name }}</h4>
            <span class="rarity-badge" [style.color]="getRarityColor(component.rarity)">{{ component.rarity | titlecase }}</span>
          </div>
          
          <div class="component-type">{{ component.type | titlecase }}</div>
          <p class="component-description">{{ component.description }}</p>
          
          <div class="component-effects">
            <strong>Effects:</strong> {{ getEffectText(component) }}
          </div>

          <div class="component-actions">
            <div class="price">{{ component.price | number }} coins</div>
            <button 
              class="btn btn-primary btn-small"
              [disabled]="userCoins < component.price"
              (click)="purchaseComponent(component)"
            >
              <lucide-icon name="shopping-cart"></lucide-icon>
              Buy
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Characters Tab -->
    <div class="tab-content" *ngIf="activeTab === 'characters' && !loading">
      <div class="characters-grid">
        <div class="character-card" *ngFor="let character of characters" [style.background]="getRarityGradient(character.rarity)">
          <div class="character-header">
            <h3>{{ character.name }}</h3>
            <span class="rarity-badge" [style.color]="getRarityColor(character.rarity)">{{ character.rarity | titlecase }}</span>
          </div>
          
          <div class="character-visual">
            <img [src]="'/assets/players/' + character.id + '.png'" [alt]="character.name" class="character-image" 
                 (error)="$event.target.src='/assets/avatars/default.png'">
          </div>

          <p class="character-description">{{ character.description }}</p>

          <div class="stats-grid">
            <div class="stat">
              <span class="stat-name">Speed</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width.%]="character.stats.speed"></div>
              </div>
              <span class="stat-value">{{ character.stats.speed }}</span>
            </div>
            <div class="stat">
              <span class="stat-name">Agility</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width.%]="character.stats.agility"></div>
              </div>
              <span class="stat-value">{{ character.stats.agility }}</span>
            </div>
            <div class="stat">
              <span class="stat-name">Stamina</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width.%]="character.stats.stamina"></div>
              </div>
              <span class="stat-value">{{ character.stats.stamina }}</span>
            </div>
            <div class="stat">
              <span class="stat-name">Luck</span>
              <div class="stat-bar">
                <div class="stat-fill" [style.width.%]="character.stats.luck"></div>
              </div>
              <span class="stat-value">{{ character.stats.luck }}</span>
            </div>
          </div>

          <div class="character-effects" *ngIf="character.effects.speedBonus || character.effects.furyRateBonus || character.effects.experienceBonus">
            <strong>Effects:</strong>
            <span *ngIf="character.effects.speedBonus">+{{ character.effects.speedBonus }}% Speed</span>
            <span *ngIf="character.effects.furyRateBonus">+{{ character.effects.furyRateBonus }}% Fury Rate</span>
            <span *ngIf="character.effects.experienceBonus">+{{ character.effects.experienceBonus }}% XP</span>
          </div>

          <div class="character-actions">
            <div class="price" *ngIf="character.price > 0">{{ character.price | number }} coins</div>
            <div class="price free" *ngIf="character.price === 0">FREE</div>
            <button 
              class="btn btn-primary"
              *ngIf="!isCharacterOwned(character)"
              [disabled]="!canPurchaseCharacter(character)"
              (click)="purchaseCharacter(character)"
            >
              <lucide-icon name="shopping-cart"></lucide-icon>
              <span *ngIf="character.price === 0">Get Free</span>
              <span *ngIf="character.price > 0">Buy</span>
            </button>
            <button 
              class="btn btn-success"
              *ngIf="isCharacterOwned(character)"
              (click)="equipCharacter(character)"
            >
              <lucide-icon name="user"></lucide-icon>
              Equip
            </button>
          </div>
        </div>
      </div>

      <!-- My Characters Section -->
      <div class="my-characters-section" *ngIf="myCharacters.length > 0">
        <h3>My Characters</h3>
        <div class="my-characters-grid">
          <div class="my-character-card" *ngFor="let character of myCharacters">
            <div class="character-header">
              <h4>{{ character.name }}</h4>
              <span class="rarity-badge" [style.color]="getRarityColor(character.rarity)">{{ character.rarity | titlecase }}</span>
            </div>
            
            <div class="character-visual">
              <img [src]="'/assets/players/' + character.id + '.png'" [alt]="character.name" class="character-image"
                   (error)="$event.target.src='/assets/avatars/default.png'">
            </div>

            <button 
              class="btn btn-primary btn-small"
              (click)="equipCharacter(character)"
            >
              <lucide-icon name="user"></lucide-icon>
              Equip
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- My Rackets Tab -->
    <div class="tab-content" *ngIf="activeTab === 'my-rackets' && !loading">
      <div class="my-rackets-grid">
        <div class="my-racket-card" *ngFor="let userRacket of myRackets" [class.equipped]="userRacket.isEquipped">
          <div class="racket-header">
            <h3>{{ userRacket.racketId.name }}</h3>
            <span class="equipped-badge" *ngIf="userRacket.isEquipped">Equipped</span>
          </div>

          <div class="racket-visual">
            <div class="racket-preview" 
                 [style.background]="'linear-gradient(45deg, ' + userRacket.racketId.visualConfig.frameColor + ', ' + userRacket.racketId.visualConfig.handleColor + ')'">
              ðŸŽ¾
            </div>
          </div>

          <div class="durability-bar">
            <div class="durability-fill" [style.width.%]="userRacket.durability"></div>
            <span class="durability-text">{{ userRacket.durability }}% Durability</span>
          </div>

          <div class="total-stats">
            <div class="stat" *ngFor="let stat of ['power', 'control', 'speed', 'durability']">
              <lucide-icon [name]="getStatIcon(stat)"></lucide-icon>
              <span>{{ getStatValue(userRacket.totalStats, stat) }}</span>
            </div>
          </div>

          <div class="racket-actions">
            <button 
              class="btn btn-outline btn-small"
              (click)="customizeRacket(userRacket)"
            >
              Customize
            </button>
            <button 
              class="btn btn-primary btn-small"
              [disabled]="userRacket.isEquipped"
              (click)="equipRacket(userRacket)"
            >
              <span *ngIf="!userRacket.isEquipped">Equip</span>
              <span *ngIf="userRacket.isEquipped">Equipped</span>
            </button>
            <button 
              class="btn btn-secondary btn-small"
              *ngIf="!userRacket.isEquipped && !userRacket.isRented && !userRacket.rentPrice"
              (click)="openRentModal(userRacket)"
            >
              Set for Rent
            </button>
            <button 
              class="btn btn-outline btn-small"
              *ngIf="userRacket.rentPrice && !userRacket.isRented"
              (click)="removeFromRent(userRacket)"
            >
              Remove from Rent
            </button>
            <div class="rent-info" *ngIf="userRacket.rentPrice && !userRacket.isRented">
              <small>For rent: {{ userRacket.rentPrice }} coins/{{ userRacket.rentDuration }}h</small>
            </div>
            <div class="rent-info" *ngIf="userRacket.isRented">
              <small>Rented until: {{ userRacket.rentExpiresAt | date:'short' }}</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rental Market Tab -->
    <div class="tab-content" *ngIf="activeTab === 'rental-market' && !loading">
      <div class="rental-market-grid">
        <div class="rental-card" *ngFor="let rental of rentalMarket">
          <div class="rental-header">
            <h3>{{ rental.racketId.name }}</h3>
            <span class="rarity-badge" [style.color]="getRarityColor(rental.racketId.rarity)">
              {{ rental.racketId.rarity | titlecase }}
            </span>
          </div>

          <div class="owner-info">
            <img [src]="rental.userId.avatar || '/assets/avatars/default.png'" alt="Owner" class="owner-avatar">
            <span>{{ rental.userId.username }}</span>
          </div>

          <div class="racket-visual">
            <div class="racket-preview" 
                 [style.background]="'linear-gradient(45deg, ' + rental.racketId.visualConfig.frameColor + ', ' + rental.racketId.visualConfig.handleColor + ')'">
              ðŸŽ¾
            </div>
          </div>

          <div class="rental-stats">
            <div class="stat" *ngFor="let stat of ['power', 'control', 'speed', 'durability']">
              <lucide-icon [name]="getStatIcon(stat)"></lucide-icon>
              <span>{{ getStatValue(rental.totalStats, stat) }}</span>
            </div>
          </div>

          <div class="rental-info">
            <div class="rent-price">{{ rental.rentPrice }} coins</div>
            <div class="rent-duration">{{ rental.rentDuration }} hours</div>
          </div>

          <button 
            class="btn btn-primary"
            [disabled]="!rental.rentPrice || userCoins < rental.rentPrice"
            (click)="rentRacket(rental)"
          >
            Rent Now
          </button>
        </div>
      </div>
    </div>

    <!-- My Rentals Tab -->
    <div class="tab-content" *ngIf="activeTab === 'my-rentals' && !loading">
      <div class="my-rentals-grid">
        <div class="rental-card" *ngFor="let rental of myRentals">
          <div class="rental-header">
            <h3>{{ rental.racketId.name }}</h3>
            <span class="expires-badge">
              Expires: {{ rental.rentExpiresAt | date:'short' }}
            </span>
          </div>

          <div class="owner-info">
            <img [src]="rental.userId.avatar || '/assets/avatars/default.png'" alt="Owner" class="owner-avatar">
            <span>Owner: {{ rental.userId.username }}</span>
          </div>

          <div class="racket-visual">
            <div class="racket-preview" 
                 [style.background]="'linear-gradient(45deg, ' + rental.racketId.visualConfig.frameColor + ', ' + rental.racketId.visualConfig.handleColor + ')'">
              ðŸŽ¾
            </div>
          </div>

          <div class="rental-stats">
            <div class="stat" *ngFor="let stat of ['power', 'control', 'speed', 'durability']">
              <lucide-icon [name]="getStatIcon(stat)"></lucide-icon>
              <span>{{ getStatValue(rental.totalStats, stat) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rent Modal -->
    <div class="modal-overlay" *ngIf="showRentModal" (click)="closeRentModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Set Racket for Rent</h3>
        <div class="modal-body">
          <div class="form-group">
            <label>Rent Price (coins per hour)</label>
            <input type="number" [(ngModel)]="rentPrice" min="1" max="1000">
          </div>
          <div class="form-group">
            <label>Duration (hours)</label>
            <select [(ngModel)]="rentDuration">
              <option value="1">1 hour</option>
              <option value="6">6 hours</option>
              <option value="12">12 hours</option>
              <option value="24">24 hours</option>
              <option value="48">48 hours</option>
              <option value="72">72 hours</option>
            </select>
          </div>
          <div class="total-price">
            Total: {{ rentPrice * rentDuration }} coins
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-outline" (click)="closeRentModal()">Cancel</button>
          <button class="btn btn-primary" (click)="setForRent()">Set for Rent</button>
        </div>
      </div>
    </div>
  </div>
</div>